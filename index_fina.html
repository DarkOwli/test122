  <!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Only-Fans.co ‚Äî –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å @darkowli</title>
  <style>
    :root { --bg:#0b0d12; --card:#121623; --muted:#9aa3b2; --accent:#6c8cff; --accent-2:#9b6cff; }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;background:radial-gradient(1200px 600px at 10% -10%, #1a1f33 0%, rgba(10,12,18,0) 60%),radial-gradient(1000px 500px at 110% 10%, #18132a 0%, rgba(10,12,18,0) 60%),var(--bg);color:#fff;overflow-x:hidden}
    .wrap{display:flex;align-items:center;justify-content:center;min-height:100dvh;padding:24px}
    .card{width:100%;max-width:calc(520px - 5mm);background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.005)),var(--card);border:1px solid rgba(255,255,255,.08);border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.04);overflow:hidden}
    .header{padding:24px 24px 12px;display:grid;grid-template-columns:72px 1fr;gap:16px;align-items:center}
    .avatar{width:72px;height:72px;border-radius:16px;background:#0d1117;overflow:hidden;display:grid;place-items:center;border:1px solid rgba(255,255,255,.1)}
    .avatar img{width:100%;height:100%;object-fit:cover}
    .name{font-size:22px;font-weight:700;letter-spacing:.2px}
    .subname{color:var(--muted);font-size:14px}
    .stats{display:flex;gap:14px;margin-top:8px;color:#cbd5e1;font-size:13px}
    .tag{color:#a3adff;background:rgba(163,173,255,.08);border:1px solid rgba(163,173,255,.25);padding:2px 8px;border-radius:999px;font-size:12px}
    .cover{height:180px;background:linear-gradient(120deg, rgba(108,140,255,.18), rgba(155,108,255,.18)),url('cover.jpg') center/cover no-repeat;filter:saturate(1.1);position:relative}
    .cover::after{content:"";position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,0),rgba(0,0,0,.45))}
    .content{padding:20px 24px 24px;display:grid;gap:14px}
    .note{color:var(--muted);font-size:14px;line-height:1.5}
    .cta{display:flex;gap:10px;flex-wrap:wrap;margin-top:4px}
    .btn{cursor:pointer;border:none;border-radius:12px;font-weight:700;padding:12px 16px;transition:transform .12s ease, box-shadow .2s ease, background .2s}
    .btn:active{transform:translateY(1px)}
    .btn-primary{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#fff;box-shadow:0 10px 30px rgba(124,104,255,.35)}
    .btn-ghost{background:rgba(255,255,255,.06);color:#e5e7eb;border:1px solid rgba(255,255,255,.1)}
    .age{display:flex;align-items:center;gap:8px;color:#eab308;font-size:13px}
    .loader{display:none;align-items:center;gap:10px;color:#cbd5e1;font-size:14px}
    .dot{width:6px;height:6px;border-radius:50%;background:#cbd5e1;animation:pulse 1.2s infinite ease-in-out}
    .dot:nth-child(2){animation-delay:.2s}.dot:nth-child(3){animation-delay:.4s}
    @keyframes pulse{0%,80%,100%{opacity:.2;transform:scale(.8)}40%{opacity:1;transform:scale(1)}}
    .screamer{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:#000;z-index:99999;cursor:none;animation:flash 120ms steps(2,end) 12}
    .screamer video{width:100vw;height:100vh;object-fit:cover;image-rendering:crisp-edges;filter:contrast(1.15) saturate(1.1)}
    @keyframes flash{50%{background:#0a0a0a}}
    .shake{animation:shake .5s linear 2}
    @keyframes shake{0%{transform:translate(0,0)}20%{transform:translate(-6px,3px)}40%{transform:translate(7px,-4px)}60%{transform:translate(-5px,2px)}80%{transform:translate(4px,-3px)}100%{transform:translate(0,0)}}
    .hint{font-size:12px;color:#9aa3b2}
    .footer{text-align:center;color:#6b7280;padding:18px;font-size:12px}
    .link{color:#a3adff;text-decoration:none}
    /* Legal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(3,6,23,.76);backdrop-filter:blur(6px);display:none;align-items:center;justify-content:center;z-index:100030}
    .modal{width:min(720px,94vw);max-height:86vh;overflow:auto;background:#0f1422;border:1px solid rgba(255,255,255,.12);border-radius:18px;box-shadow:0 30px 80px rgba(0,0,0,.5)}
    .modal .m-head{padding:20px 22px;border-bottom:1px solid rgba(255,255,255,.08);display:flex;align-items:center;gap:12px}
    .modal .m-head h3{margin:0;font-size:20px}
    .modal .m-body{padding:18px 22px;color:#d1d5db;line-height:1.6}
    .modal .m-body h4{margin:16px 0 6px;font-size:18px;color:#e5e7eb}
    .modal .m-body p{margin:8px 0}
    .modal .m-body ul{margin:6px 0 12px 18px}
    .modal .m-foot{padding:16px 22px;border-top:1px solid rgba(255,255,255,.08);display:flex;gap:10px;justify-content:flex-end}
    .x{margin-left:auto;cursor:pointer;opacity:.7}
    .cookiebar{position:fixed;left:12px;right:12px;bottom:12px;background:#111726;border:1px solid rgba(255,255,255,.12);border-radius:14px;padding:14px 16px;display:none;gap:12px;align-items:center;z-index:100020}
    .cookiebar p{margin:0;color:#cdd3df;font-size:14px}
    .agegate{position:fixed;inset:0;background:radial-gradient(1200px 600px at 50% -10%, rgba(108,140,255,.12), rgba(155,108,255,.06)), rgba(6,8,16,.96);display:flex;align-items:center;justify-content:center;z-index:100010}
    .agecard{width:min(760px,94vw);background:#0f1422;border:1px solid rgba(255,255,255,.12);border-radius:22px;box-shadow:0 30px 80px rgba(0,0,0,.55);padding:26px}
    .brand{font-weight:800;font-size:42px;line-height:1;letter-spacing:.5px}
    .brand small{font-size:12px;opacity:.7;margin-right:6px}
    .muted{color:#9aa3b2}
    .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}
    .btn-outline{background:transparent;border:1px solid rgba(255,255,255,.2);color:#e5e7eb}
    .link-inline{color:#a3adff;text-decoration:none}

    /* Debug panel */
    .dbg{position:fixed;right:10px;bottom:10px;z-index:100050;font-size:12px;color:#cbd5e1}
    .dbg summary{cursor:pointer;opacity:.8}
    .dbg pre{max-width:min(46vw,520px);max-height:40vh;overflow:auto;background:#0b1220;border:1px solid rgba(255,255,255,.12);padding:10px;border-radius:10px}
    .warn{position:fixed;left:50%;transform:translateX(-50%);bottom:56px;background:#1f2937;color:#fff;border:1px solid rgba(255,255,255,.18);padding:8px 10px;border-radius:10px;font-size:12px;display:none;z-index:100040}
  
/* Online blinking dot near username (no text changes) */
.name{position:relative;display:inline-flex;align-items:center;gap:8px}
.name::after{
  content:"";width:8px;height:8px;border-radius:999px;background:#22c55e;
  margin-left:8px;box-shadow:0 0 0 rgba(34,197,94,.7);animation:pulseDot 1.6s ease-out infinite;
}
@keyframes pulseDot{
  0%{box-shadow:0 0 0 0 rgba(34,197,94,.55);transform:scale(1);}
  70%{box-shadow:0 0 0 12px rgba(34,197,94,0);transform:scale(1.06);}
  100%{box-shadow:0 0 0 0 rgba(34,197,94,0);transform:scale(1);}
}
</style>

<style id="extra-pulse-and-gotcha">
/* Blinking online dot for status */
.status > span:first-child{
  width:8px;height:8px;border-radius:999px;background:#22c55e !important;
  display:inline-block;position:relative;
  box-shadow:0 0 0 rgba(34,197,94,.7);
  animation:pulseDot 1.6s ease-out infinite;
}
@keyframes pulseDot{
  0%{ box-shadow:0 0 0 0 rgba(34,197,94,.55); transform:scale(1); opacity:1;}
  70%{ box-shadow:0 0 0 12px rgba(34,197,94,0); transform:scale(1.06); opacity:1;}
  100%{ box-shadow:0 0 0 0 rgba(34,197,94,0); transform:scale(1); opacity:1;}
}

/* Gotcha scene */
#gotcha{
  position:fixed; inset:0; z-index:100200;
  display:none; align-items:center; justify-content:center;
  background:radial-gradient(1000px 800px at 50% -10%, rgba(0,200,120,.08), transparent 60%), #0b0d12;
  color:#fff; text-align:center; padding:24px;
}
#gotcha .box{
  background:rgba(30,35,55,.9);
  border:1px solid rgba(255,255,255,.12);
  border-radius:18px; padding:28px 32px; max-width:720px;
  box-shadow:0 30px 80px rgba(0,0,0,.5);
}
#gotcha h1{ margin:0 0 12px; font-size:38px; line-height:1.15; }
#gotcha .emo{ font-size:56px; display:inline-block; margin-left:10px;
  animation:laugh 1.2s infinite;
}
@keyframes laugh{
  0%{ transform:translateY(0) rotate(0deg) scale(1); }
  25%{ transform:translateY(-4px) rotate(-8deg) scale(1.05); }
  50%{ transform:translateY(0) rotate(0deg) scale(1); }
  75%{ transform:translateY(-4px) rotate(8deg) scale(1.05); }
  100%{ transform:translateY(0) rotate(0deg) scale(1); }
}
#gotcha p{ margin:8px 0 0; color:#aab2c5; }

/* View counter badge (top-left) */
#viewsBadge {
  position: fixed;
  top: 10px;
  left: 10px;
  /* Slightly lighter and higher contrast for better visibility */
  background: rgba(17,27,45,.85);
  border-radius: 999px;
  border: 1px solid rgba(207,216,229,.45);
  padding: 6px 10px;
  font-size: 12px;
  color: #f9fafb;
  z-index: 100005;
  pointer-events: none;
}

/* Lock scene overlay (shown when content already viewed) */
#lockScene {
  position: fixed;
  inset: 0;
  z-index: 100250;
  display: none;
  align-items: center;
  justify-content: center;
  background: radial-gradient(1000px 800px at 50% -10%, rgba(248,113,113,.15), transparent 60%), #050712;
  color: #fff;
  text-align: center;
  padding: 24px;
}
#lockScene .box {
  background: rgba(24,29,49,.96);
  border: 1px solid rgba(248,113,113,.45);
  border-radius: 18px;
  padding: 28px 32px;
  max-width: 720px;
  box-shadow: 0 30px 80px rgba(0,0,0,.65);
}
#lockScene h1 {
  margin: 0 0 14px;
  font-size: 34px;
  line-height: 1.2;
  color: #f9fafb;
}
#lockScene .cross {
  color: #f97373;
  margin-left: 10px;
  font-size: 42px;
  display: inline-block;
  animation: floatX 1.6s ease-in-out infinite;
}
@keyframes floatX {
  0%   { transform: translateY(0) rotate(0deg);     opacity: 1; }
  50%  { transform: translateY(-6px) rotate(-6deg); opacity: .9; }
  100% { transform: translateY(0) rotate(0deg);     opacity: 1; }
}
#lockScene p {
  margin: 6px 0 0;
  color: #e5e7eb;
}
#lockTimer {
  margin-top: 10px;
  font-size: 20px;
  font-weight: 600;
  letter-spacing: .08em;
  color: #fecaca;
}
</style>
</head>
<body>
  <!-- View counter badge -->
  <div id="viewsBadge">üëÅ 0</div>
  <div class="wrap">
    <div class="card" id="card">
      <div class="cover"></div>
      <div class="header">
        <div class="avatar"><img src="a001.gif" alt="DarkOwli" /></div>
        <div>
          <div class="name">DarkOwli</div>
          <div class="subname">@darkowli ¬∑ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç</div>
          <div class="stats"><span>12.4k –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤</span><span>¬∑</span><span>89 –ø–æ—Å—Ç–æ–≤</span><span class="tag">18+</span></div>
        </div>
      </div>
      <div class="content">
        <p class="note">–ù–∞–∂–∏–º–∞—è ¬´–û—Ç–∫—Ä—ã—Ç—å –¥–æ—Å—Ç—É–ø¬ª, –≤—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç–µ, —á—Ç–æ –≤–∞–º –µ—Å—Ç—å 18 –ª–µ—Ç.</p>
        <div class="age">‚ö†Ô∏è –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–ø–∞—Å–Ω—ã–º –¥–ª—è –≤–æ—Å–ø—Ä–∏—è—Ç–∏—è.</div>
        <div class="cta">
          <button class="btn btn-primary" id="openBtn">–û—Ç–∫—Ä—ã—Ç—å –¥–æ—Å—Ç—É–ø(–ü–æ –ø–ª–∞—Ç–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–µ)</button>
          <button class="btn btn-ghost" id="previewBtn">–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</button>
        </div>
        <div class="loader" id="loader"><div class="dot"></div><div class="dot"></div><div class="dot"></div><span>–ó–∞–≥—Ä—É–∂–∞–µ–º –º–µ–¥–∏–∞-–¥–∞–Ω–Ω—ã–µ‚Ä¶</span></div>
        <div class="hint" id="soundHint" style="display:none">–ù–∞–∂–º–∏—Ç–µ –µ—â—ë —Ä–∞–∑, —á—Ç–æ–±—ã –≤–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫ (–±—Ä–∞—É–∑–µ—Ä —Ç—Ä–µ–±—É–µ—Ç –∂–µ—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è).</div>
      </div>
      <div class="footer">¬© Coppy rights reserved.. <a class="link" href="#" id="infoLink">–ò–Ω—Ñ–æ</a> ¬∑ Only-Fans.co</div>
    </div>
  </div>

  <!-- Lock scene overlay (shown when user revisits within cooldown) -->
  <div id="lockScene">
    <div class="box">
      <h1>–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω <span class="cross">‚úñ</span></h1>
      <p>–ö–æ–Ω—Ç–µ–Ω—Ç —É–∂–µ –±—ã–ª –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω. –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑:</p>
      <div id="lockTimer">30 –¥ 00:00:00</div>
      <p style="margin-top:10px;font-size:13px;color:#cbd5e1;">–û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É, –∫–æ–≥–¥–∞ —Ç–∞–π–º–µ—Ä –¥–æ–π–¥—ë—Ç –¥–æ –Ω—É–ª—è.</p>
    </div>
  </div>

  <!-- Screamer overlay (uses video) -->
  <div class="screamer" id="screamer">
    <video id="screamVideo" src="v001.mp4" preload="auto" playsinline webkit-playsinline></video>
  </div>

  <!-- Cookie bar -->
  <div class="cookiebar" id="cookieBar">
    <!-- Warning message area: shown when user tries to start without accepting cookies -->
    <div id="cookieWarn" style="display:none;color:#f87171;font-size:13px;margin-bottom:6px"></div>
    <p>–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º cookies –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏. –ù–∞–∂–∏–º–∞—è ¬´–ü—Ä–∏–Ω—è—Ç—å¬ª, –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å <a href="#" id="openPolicy2" class="link-inline">–ü–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>.</p>
    <div class="row"><button class="btn btn-ghost" id="cookieDecline">–û—Ç–∫–ª–æ–Ω–∏—Ç—å</button><button class="btn btn-primary" id="cookieAccept">–ü—Ä–∏–Ω—è—Ç—å</button></div>
  </div>

  <!-- Age gate -->
  <div class="agegate" id="ageGate">
    <div class="agecard">
      <div class="brand">Only-Fans<span style="font-weight:300">.co</span></div>
      <h2 style="margin:12px 0 6px">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑—Ä–∞—Å—Ç–∞!</h2>
      <p class="muted">–í–Ω—É—Ç—Ä–∏ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç 18+ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞, –≤–æ–π–¥—è –≤—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç–µ, —á—Ç–æ –≤–∞–º –µ—Å—Ç—å 18 –ª–µ—Ç –∏ –≤—ã —Å–æ–≥–ª–∞—Å–Ω—ã —Å —É—Å–ª–æ–≤–∏—è–º–∏.</p>
      <div class="row">
        <button class="btn btn-primary" id="ageAccept">Accept</button>
        <button class="btn btn-outline" id="ageDecline">Decline</button>
        <a href="#" id="openTerms1" class="link-inline">Terms & Conditions</a>
        <span>¬∑</span>
        <a href="#" id="openPolicy1" class="link-inline">Privacy Policy</a>
      </div>
    </div>
  </div>

  <!-- Terms -->
  <div class="modal-backdrop" id="termsModal">
    <div class="modal">
      <div class="m-head"><h3>Terms and Conditions</h3><span class="x" id="closeTerms">‚úï</span></div>
      <div class="m-body">
        <p>Content on this site is for entertainment purposes only. By clicking ‚ÄúAccept‚Äù you confirm you are at least 18 years old or of legal age in your jurisdiction and choose to view the content for personal use.</p>
        <p>You use this website at your own risk. We are not responsible for discomfort, anxiety, or any damage that may occur as a result of viewing or interacting with the website (including jumpscares / loud audio).</p>
        <p>Do not use this website if you have medical conditions affected by sudden surprises or scares (e.g., epilepsy or seizure disorders).</p>
        <p>This website is not affiliated with, endorsed by, or associated with ‚Äúonlyfans.com‚Äù. The name and styling are satirical and humorous.</p>
      </div>
      <div class="m-foot"><button class="btn btn-ghost" id="closeTerms2">Close</button></div>
    </div>
  </div>

  <!-- Privacy -->
  <div class="modal-backdrop" id="policyModal">
    <div class="modal">
      <div class="m-head"><h3>Privacy Policy</h3><span class="x" id="closePolicy">‚úï</span></div>
      <div class="m-body">
        <h4>1. Information Collection</h4>
        <ul><li>Data you provide (e.g., when interacting with the page).</li><li>Log data (IP address, browser type), device info, and usage analytics.</li></ul>
        <h4>2. Use of Information</h4>
        <ul><li>Provide, maintain, and improve the service and security (e.g., DDOS prevention).</li><li>Identify sessions via usernames/IPs for custom features.</li></ul>
        <h4>3. Cookies</h4>
        <ul><li>Remember preferences and gate decisions.</li><li>Collect basic analytics to improve performance and UX.</li></ul>
        <h4>4. Data Protection</h4>
        <p>We apply reasonable security measures, but no method is 100% secure.</p>
        <h4>5. User Rights (GDPR)</h4>
        <ul><li>Access, correction, deletion, and objection rights where applicable.</li></ul>
      </div>
      <div class="m-foot"><button class="btn btn-ghost" id="closePolicy2">Close</button></div>
    </div>
  </div>

  <div class="warn" id="warn"></div>
  <details class="dbg"><summary>Diagnostics</summary><pre id="dbg"></pre><div style="margin-top:6px"><button class="btn btn-ghost" id="runTests">Run tests</button></div></details>

<script>
(function(){
  const qs = id => document.getElementById(id);
  const body = document.body;
  // Main
  const openBtn = qs('openBtn');
  const previewBtn = qs('previewBtn');
  const loader = qs('loader');
  const screamer = qs('screamer');
  const video = qs('screamVideo');
  const infoLink = qs('infoLink');
  const soundHint = qs('soundHint');
  const warn = qs('warn');

  // Legal
  const cookieBar = qs('cookieBar');
  const cAccept = qs('cookieAccept');
  const cDecline = qs('cookieDecline');
  const ageGate = qs('ageGate');
  const aAccept = qs('ageAccept');
  const aDecline = qs('ageDecline');
  const termsModal = qs('termsModal');
  const policyModal = qs('policyModal');
  const openTerms1 = qs('openTerms1');
  const openPolicy1 = qs('openPolicy1');
  const openPolicy2 = qs('openPolicy2');
  const closeTerms = qs('closeTerms');
  const closeTerms2 = qs('closeTerms2');
  const closePolicy = qs('closePolicy');
  const closePolicy2 = qs('closePolicy2');

  // Z layers
  ageGate.style.zIndex = 100010; // base gate
  termsModal.style.zIndex = 100030; // above gate
  policyModal.style.zIndex = 100030;

  // Show age gate or cookie bar on load based on localStorage
  document.addEventListener('DOMContentLoaded', () => {
    // Update view counter badge: show how many times the video was fully viewed
    try {
      const v = parseInt(localStorage.getItem('VideoFullViews') || '0', 10);
      const badge = document.getElementById('viewsBadge');
      if (badge) badge.textContent = 'üëÅ ' + v;
    } catch (_) {}
    // Always show the age gate on page load.
    // We don't persist the user's age acceptance beyond the current visit,
    // so every time the page loads a fresh agreement is required.
    showFlex(ageGate);
    hide(cookieBar);
    lockScroll();
  });

  // WebAudio chain for LOUD playback (‚âà240%)
  let ctx=null, gain=null, srcNode=null; let audioReady=false, audioFailed=false;
  function ensureAudioGraph(){
    if(audioReady || audioFailed) return;
    try{
      ctx = new (window.AudioContext||window.webkitAudioContext)();
      gain = ctx.createGain();
      gain.gain.value = 2.4; // 240%
      srcNode = ctx.createMediaElementSource(video);
      srcNode.connect(gain).connect(ctx.destination);
      audioReady = true;
    }catch(e){
      audioFailed = true;
      log('WebAudio init failed: '+e);
      toast('–ë—Ä–∞—É–∑–µ—Ä/–ø–µ—Å–æ—á–Ω–∏—Ü–∞ –∑–∞–ø—Ä–µ—Ç–∏–ª–∏ —É—Å–∏–ª–µ–Ω–∏–µ –∑–≤—É–∫–∞. –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –∑–≤—É–∫ —Å –æ–±—ã—á–Ω–æ–π –≥—Ä–æ–º–∫–æ—Å—Ç—å—é.');
    }
  }

  // Helpers
  function showFlex(el){ if(el) el.style.display='flex'; }
  function showBlock(el){ if(el) el.style.display='block'; }
  function hide(el){ if(el) el.style.display='none'; }
  function lockScroll(){ body.style.overflow='hidden'; }
  function unlockScroll(){ body.style.overflow=''; }
  function log(msg){ const dbg = qs('dbg'); if(dbg){ dbg.textContent += msg+'\n'; } }
  function toast(msg){ if(!warn) return; warn.textContent = msg; warn.style.display='block'; clearTimeout(warn.__t); warn.__t=setTimeout(()=>warn.style.display='none', 4000); }

  // Age Gate actions
  aAccept.addEventListener('click', () => {
    // Hide the age gate once the user accepts.
    // We do not persist the acceptance across sessions,
    // ensuring the gate will reappear on the next page load.
    hide(ageGate);
    unlockScroll();
    // Show the cookie bar only if cookies have not been accepted yet.
    if (!sessionStorage.getItem('cookiesAccepted')) {
      showBlock(cookieBar);
    }
  });
  aDecline.addEventListener('click', () => { window.location.href = 'https://google.com'; });

  // Cookie bar actions
  cAccept.addEventListener('click', () => {
    try {
      // Remember cookie acceptance only for the current browsing session.
      sessionStorage.setItem('cookiesAccepted', '1');
    } catch (_) {}
    // Hide any warning message within cookie bar
    var warnEl = document.getElementById('cookieWarn');
    if(warnEl){ warnEl.style.display = 'none'; }
    hide(cookieBar);
  });
  cDecline.addEventListener('click', () => {
    // Declining cookies: no site functionality, just hide the bar
    hide(cookieBar);
  });

  // Modals
  function bindModal(openBtn, modal, closeA, closeB){
    if(openBtn){ openBtn.addEventListener('click', (e)=>{ e.preventDefault(); showFlex(modal); lockScroll(); }); }
    const close = ()=>{ hide(modal); if(ageGate.style.display==='flex'){ lockScroll(); } else { unlockScroll(); } };
    closeA && closeA.addEventListener('click', close);
    closeB && closeB.addEventListener('click', close);
    modal && modal.addEventListener('click', (e)=>{ if(e.target===modal) close(); });
  }
  bindModal(openTerms1, termsModal, closeTerms, closeTerms2);
  bindModal(openPolicy1, policyModal, closePolicy, closePolicy2);
  bindModal(openPolicy2, policyModal, closePolicy, closePolicy2);

  // Screamer flow (permission-policy safe)
  video.muted = false;
  video.volume = 1.0; // WebAudio does the boost
  video.loop = false;
  video.controls = false;

  function tryFullscreen(){
    const el = document.documentElement;
    if(!document || !('fullscreenEnabled' in document)) return Promise.resolve('no-api');
    if(!document.fullscreenEnabled){ log('Fullscreen not enabled by policy'); return Promise.resolve('disabled'); }
    try{
      const p = el.requestFullscreen ? el.requestFullscreen({ navigationUI:'hide' }) : Promise.resolve('no-api');
      return Promise.resolve(p).catch(err=>{ log('Fullscreen request failed: '+err); return 'failed'; });
    }catch(err){ log('Fullscreen exception: '+err); return Promise.resolve('failed'); }
  }

  function fakeLoadThenScream(){
    showFlex(loader);
    const delay = 1200 + Math.random()*2400;
    setTimeout(()=>triggerScreamer(), delay);
  }
  window.fakeLoadThenScream = fakeLoadThenScream;


  async function triggerScreamer(){
    ensureAudioGraph();
    if(ctx && ctx.state==='suspended'){
      try{ await ctx.resume(); }catch(e){ log('AudioContext resume blocked: '+e); }
    }

    await tryFullscreen(); // don't crash if disallowed by permissions policy

    showFlex(screamer);
    body.classList.add('shake');

    try{
      await video.play();
    }catch(err){
      log('video.play() blocked: '+err);
      soundHint.style.display='block';
      toast('–ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ. –ù–∞–∂–º–∏—Ç–µ –ø–æ —ç–∫—Ä–∞–Ω—É, —á—Ç–æ–±—ã –∑–∞–ø—É—Å—Ç–∏—Ç—å.');
      screamer.addEventListener('click', forcePlayOnce, { once:true });
      // start mp3 overlay even if video can't start
      document.dispatchEvent(new Event('mp3fallback-start'));
    }

    setTimeout(()=>{
      document.addEventListener('keydown', onEsc);
      screamer.addEventListener('click', closeScreamer, { once:true });
    }, 1500);
  }
  window.triggerScreamer = triggerScreamer;


  async function forcePlayOnce(){
    ensureAudioGraph();
    if(ctx && ctx.state==='suspended'){
      try{ await ctx.resume(); }catch(e){ log('resume failed: '+e); }
    }
    try{ await video.play(); soundHint.style.display='none'; }catch(e){ toast('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤–∏–¥–µ–æ: '+e); }
    // ensure mp3 overlay starts regardless
    document.dispatchEvent(new Event('mp3fallback-start'));
  }

  function closeScreamer(){
    try{ if(document.fullscreenElement) document.exitFullscreen(); }catch(_){ /* ignore in sandbox */ }
    hide(screamer);
    video.pause(); video.currentTime = 0;
    body.classList.remove('shake');
    hide(loader);
  }
  function onEsc(e){ if(e.key==='Escape'){ closeScreamer(); document.removeEventListener('keydown', onEsc); } }

  // Close on video end
  video.addEventListener('ended', closeScreamer);

  // Buttons
  // Launch flow only if cookies have been accepted. Otherwise, show cookie warning and keep cookie bar visible.
  openBtn.addEventListener('click', (e) => {
    // Check cookiesAccepted in sessionStorage
    if (sessionStorage.getItem('cookiesAccepted') !== '1') {
      e.preventDefault();
      // Show cookie bar and display warning inside it
      showBlock(cookieBar);
      var warnEl = document.getElementById('cookieWarn');
      if(warnEl){
        warnEl.textContent = '–ù–∞ –¥–∞–Ω–Ω–æ–º —Å–∞–π—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã cookie-—Ñ–∞–π–ª—ã. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–∏–º–∏—Ç–µ –∏—Ö, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å.';
        warnEl.style.display = 'block';
      }
      // Also toast the message for extra visibility
      toast('–ù–∞ –¥–∞–Ω–Ω–æ–º —Å–∞–π—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã cookie-—Ñ–∞–π–ª—ã. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–∏–º–∏—Ç–µ –∏—Ö, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å.');
      return;
    }
    showBlock(loader);
    setTimeout(fakeLoadThenScream, 500);
  });
  previewBtn.addEventListener('click', (e) => {
    if (sessionStorage.getItem('cookiesAccepted') !== '1') {
      e.preventDefault();
      // Show cookie bar and display warning inside it
      showBlock(cookieBar);
      var warnEl = document.getElementById('cookieWarn');
      if(warnEl){
        warnEl.textContent = '–ù–∞ –¥–∞–Ω–Ω–æ–º —Å–∞–π—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã cookie-—Ñ–∞–π–ª—ã. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–∏–º–∏—Ç–µ –∏—Ö, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å.';
        warnEl.style.display = 'block';
      }
      toast('–ù–∞ –¥–∞–Ω–Ω–æ–º —Å–∞–π—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã cookie-—Ñ–∞–π–ª—ã. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–∏–º–∏—Ç–µ –∏—Ö, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å.');
      return;
    }
    showBlock(loader);
    // reduce initial volume for preview then ramp up
    if (gain) gain.gain.value = 1.0;
    setTimeout(fakeLoadThenScream, 500);
    setTimeout(() => { if (gain) gain.gain.value = 2.4; }, 4000);
  });
  infoLink.addEventListener('click', (e)=>{ e.preventDefault(); alert('This info menu disabled.'); });

  // === Built-in tests ===
  const runTestsBtn = qs('runTests');
  runTestsBtn && runTestsBtn.addEventListener('click', runTests);
  async function runTests(){
    const results = [];
    results.push(['FullScreen API', !!document.fullscreenEnabled]);
    results.push(['FullScreen enabled', document.fullscreenEnabled===true]);
    results.push(['Autoplay policy gesture?', 'click required']);
    // Try a silent play test on a tiny muted clone
    const testV = document.createElement('video');
    testV.src = video.currentSrc || video.src; testV.muted = true; testV.playsInline = true;
    try{ await testV.play(); results.push(['Muted autoplay', 'OK']); }catch(e){ results.push(['Muted autoplay', 'Blocked: '+e.name]); }
    // WebAudio
    try{
      const AC = (window.AudioContext||window.webkitAudioContext);
      results.push(['AudioContext available', !!AC]);
      if(AC){ const tctx = new AC(); results.push(['AudioContext state', tctx.state]); tctx.close(); }
    }catch(e){ results.push(['AudioContext create', 'FAILED: '+e.name]); }
    // Permissions Policy probe: try fullscreen
    try{ if(document.fullscreenEnabled){ await document.documentElement.requestFullscreen(); await document.exitFullscreen(); results.push(['Fullscreen request', 'OK']); } else { results.push(['Fullscreen request', 'Disabled by policy']); } }
    catch(e){ results.push(['Fullscreen request', 'FAILED: '+e.name]); }

    // State of cookies and counters
    try {
      results.push(['cookiesAccepted', sessionStorage.getItem('cookiesAccepted')]);
      // ageOk is stored in sessionStorage
      results.push(['ageOk', sessionStorage.getItem('ageOk')]);
      // Video-related keys: track whether the video has been viewed and when
      results.push(['VideoSeen', localStorage.getItem('VideoSeen')]);
      results.push(['VideoSeenAt', localStorage.getItem('VideoSeenAt')]);
      results.push(['VideoFullViews', localStorage.getItem('VideoFullViews')]);
    } catch(_) {
      results.push(['localStorage', 'access error']);
    }

    const dbg = qs('dbg'); if(dbg){ dbg.textContent = results.map(r=>r[0]+': '+r[1]).join('\n'); }
  }
})();
</script>

<script>
// === Minimal MP3 auto-fallback overlay (no UI text changes) ===
(function(){
  // find target <video>
  var v = document.getElementById('screamVideo') || document.querySelector('video');
  if (!v) return;

  var mp3 = null;
  var SYNC_TOL = 0.25;

  function ensureOverlay(){
    if (mp3) return;
    mp3 = document.createElement('audio');
    mp3.src = 'au001.mp3';        // use fallback MP3 file
    mp3.preload = 'auto';
    mp3.playsInline = true;
    // allow connecting to WebAudio context on same-origin files
    mp3.crossOrigin = 'anonymous';
    document.body.appendChild(mp3);

    // connect the fallback audio through WebAudio with a gain boost
    try {
      var AC = window.AudioContext || window.webkitAudioContext;
      if (AC) {
        // reuse existing context on window or create a new one
        var aCtx = window.__mp3Ctx || new AC();
        window.__mp3Ctx = aCtx;
        var gainNode = aCtx.createGain();
        gainNode.gain.value = 2.4;
        var srcNode = aCtx.createMediaElementSource(mp3);
        srcNode.connect(gainNode).connect(aCtx.destination);
      }
    } catch(e) {}

    // keep in sync with video
    function sync(){
      if (!mp3) return;
      var diff = Math.abs((mp3.currentTime||0) - (v.currentTime||0));
      if (diff > SYNC_TOL) { try { mp3.currentTime = v.currentTime; } catch(e){} }
      if (mp3.playbackRate !== v.playbackRate) mp3.playbackRate = v.playbackRate;
      if (v.paused && !mp3.paused) { try{ mp3.pause(); }catch(e){} }
      if (!v.paused && mp3.paused && mp3.src) { mp3.play().catch(function(){}); }
    }
    v.addEventListener('timeupdate', sync);
    v.addEventListener('seeking', function(){ try{ mp3.currentTime = v.currentTime; }catch(e){} });
    v.addEventListener('seeked', sync);
    v.addEventListener('ratechange', function(){ mp3.playbackRate = v.playbackRate; });
    v.addEventListener('pause', function(){ if(mp3) try{ mp3.pause(); }catch(e){} });
    v.addEventListener('ended', function(){ if(mp3){ try{ mp3.pause(); mp3.currentTime=0; }catch(e){} } });
  }

  function startOverlay(){
    ensureOverlay();
    try{
      mp3.currentTime = v.currentTime || 0;
      mp3.playbackRate = v.playbackRate || 1;
      mp3.muted = false;
      mp3.play().catch(function(){});
    }catch(e){}
  }

  // Auto-start MP3 when video starts playing
  v.addEventListener('play', startOverlay);
  // Also allow manual trigger if video can't start
  document.addEventListener('mp3fallback-start', startOverlay);

  // If your code manually starts video and autoplay is blocked,
  // this fallback will still engage once the user triggers play.
})();
</script>

<!-- Gotcha scene -->
<div id="gotcha">
  <div class="box">
    <h1>–ü–æ–ø–∞–ª—Å—è –Ω–µ–≥–æ–¥–Ω–∏–∫! <span class="emo">üòÇ</span></h1>
    <p>P.s. –ù–µ –Ω—É –∞ —á—Ç–æ —Ç—ã —Ç—É—Ç —É–≤–∏–¥–µ—Ç—å —Ö–æ—Ç–µ–ª(–∞)?</p>
  </div>
</div>

<script id="gotcha-logic">
(function(){
  var screamer = document.getElementById('screamer');
  var video = document.getElementById('screamVideo') || (screamer ? screamer.querySelector('video') : null);
  var gotcha = document.getElementById('gotcha');
  var loader = document.getElementById('loader');
  var openBtn = document.getElementById('openBtn');
  var previewBtn = document.getElementById('previewBtn');

  if (!video || !gotcha) return;

  function stopAllAudios(){
    try{
      document.querySelectorAll('audio').forEach(function(a){
        try{ a.pause(); }catch(e){}
      });
    }catch(e){}
  }

  function showGotcha(){
    // hide screamer & loader, stop media
    try{ if (video){ video.pause(); video.currentTime = 0; } }catch(e){}
    stopAllAudios();
    if (screamer) screamer.style.display = 'none';
    if (loader) loader.style.display = 'none';
    if (document.fullscreenElement && document.exitFullscreen){
      try{ document.exitFullscreen(); }catch(e){}
    }
    // disable start buttons to prevent re-run
    if (openBtn){ openBtn.disabled = true; openBtn.style.pointerEvents='none'; openBtn.style.opacity='0.6'; }
    if (previewBtn){ previewBtn.disabled = true; previewBtn.style.pointerEvents='none'; previewBtn.style.opacity='0.6'; }
    // record that video has been fully viewed and update counter
    try {
      // Use VideoSeen/VideoSeenAt/VideoFullViews keys to track view state
      localStorage.setItem('VideoSeen', '1');
      localStorage.setItem('VideoSeenAt', Date.now().toString());
      let v = parseInt(localStorage.getItem('VideoFullViews') || '0', 10);
      v = isFinite(v) ? v + 1 : 1;
      localStorage.setItem('VideoFullViews', v.toString());
      const badge = document.getElementById('viewsBadge');
      if (badge) badge.textContent = 'üëÅ ' + v;
    } catch (e) {}
    // show gotcha scene
    gotcha.style.display = 'flex';
    // lock scroll behind
    document.body.style.overflow = 'hidden';
  }

  // show gotcha when video ends
  video.addEventListener('ended', showGotcha);

  // optional: if user closes screamer via click, also show gotcha
  if (screamer){
    // If your original code adds its own click-to-close, our handler will still run after video ends.
    // Here we also force gotcha on any click once the screamer is visible and the video is paused.
    screamer.addEventListener('click', function(){
      if (video && video.paused) showGotcha();
    });
  }
})();
</script>

<!-- Removed auto-trigger of MP3 fallback on generic gestures. The fallback audio now starts only when the screamer is triggered. -->
<script>
/*
// Previously, this script listened for the first user gesture and dispatched an event to start the MP3 fallback.
// It has been disabled to prevent the fallback audio from starting before the video is intentionally played.
*/
</script>

<!-- Removed Click Fix script: logic moved to cookie gating script -->
  <!-- View badge update, cookie gating, and cooldown logic -->
  <script>
  // Ensure view badge reflects stored count on load
  (function(){
    document.addEventListener('DOMContentLoaded', function(){
      try {
        var v = parseInt(localStorage.getItem('VideoFullViews') || '0', 10);
        var badge = document.getElementById('viewsBadge');
        if (badge) badge.textContent = 'üëÅ ' + v;
      } catch (_) {}
    });
  })();
  </script>

  <script>
  // Cookie gating script removed: cookie checks are now performed directly in the button handlers.
  </script>

  <script>
  // Cooldown overlay: display lock scene if user tries to view again within 30 days
  (function(){
    var COOLDOWN_MS = 30*24*60*60*1000;
    function getRemaining(){
      // Use videoSeen/videoSeenAt instead of screamer* keys
      var seen = localStorage.getItem('VideoSeen');
      var tsStr = localStorage.getItem('VideoSeenAt');
      var ts = tsStr ? parseInt(tsStr, 10) : 0;
      if(seen !== '1' || !ts) return 0;
      var now = Date.now();
      var until = ts + COOLDOWN_MS;
      return Math.max(0, until - now);
    }
    function format(ms){
      if(ms <= 0) return '0 –¥ 00:00:00';
      var total = Math.floor(ms/1000);
      var d = Math.floor(total / (24*3600));
      var rest = total - d*24*3600;
      var h = Math.floor(rest / 3600);
      var m = Math.floor((rest % 3600) / 60);
      var s = rest % 60;
      var pad = function(n){ return n.toString().padStart(2,'0'); };
      return d + ' –¥ ' + pad(h) + ':' + pad(m) + ':' + pad(s);
    }
    function showLock(){
      var lockScene = document.getElementById('lockScene');
      if(!lockScene) return;
      var ageGate = document.getElementById('ageGate');
      var cookieBar = document.getElementById('cookieBar');
      if(ageGate) ageGate.style.display='none';
      if(cookieBar) cookieBar.style.display='none';
      lockScene.style.display = 'flex';
      document.body.style.overflow = 'hidden';
      var timerEl = document.getElementById('lockTimer');
      function update(){
        var ms = getRemaining();
        if(ms <= 0){
          if(timerEl) timerEl.textContent = '0 –¥ 00:00:00';
          // Clear VideoSeen keys when cooldown ends
          localStorage.removeItem('VideoSeen');
          localStorage.removeItem('VideoSeenAt');
          lockScene.style.display = 'none';
          document.body.style.overflow = '';
          clearInterval(interval);
          return;
        }
        if(timerEl) timerEl.textContent = format(ms);
      }
      update();
      var interval = setInterval(update, 1000);
    }
    document.addEventListener('DOMContentLoaded', function(){
      var rem = getRemaining();
      if(rem > 0){
        showLock();
      }
    });
  })();
  </script>

</body>
</html>
